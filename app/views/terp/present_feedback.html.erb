<%= render :partial => 'shared/response_times',
           :locals => {:response_timeable => @student_exercise,
                       :page => "feedback"} %>
<% @show_footer = true %>

<% #next_se = next_student_exercise(@student_exercise)  # broken!!! 

  next_ae = @student_exercise.assignment_exercise.next
  next_se = next_ae.nil? ?
            nil :
            StudentExercise.where{student_assignment_id == my{@student_exercise.student_assignment_id}}.where{assignment_exercise_id == my{next_ae.id}}.first

%>

<% 
   exercise = @student_exercise.assignment_exercise.topic_exercise.exercise
   learning_condition = @student_exercise.learning_condition 
%>

<%= render 'terp/question_nav', student_exercise: @student_exercise %>

<div id="question_outer" class='present_feedback'>

  <%= render "question", student_exercise: @student_exercise %>

  <%= render "the_guess" %>

  <% is_correct = @student_exercise.selected_answer == exercise.correct_choice_index %>

  <div class='terp-correctness-feedback'>
    <% if is_correct %>
      <div class='terp-correct-feedback'>Correct!</div>
    <% else %>
      <div class='terp-incorrect-feedback'>Incorrect</div>
    <% end %>
  </div>

  <%= render 'terp/answer_choices' %>


  <%= render :partial => "terp/solution_feedback", :locals => { :student_exercise => @student_exercise } %> 


 


  <div class='fixed-right-button'>
    <% if next_se.nil? %>
      <%= link_to "Got It! Summary >", 
                  terp_quiz_summary_path(
                      terp_id: params[:terp_id]),
                  {class: 'link_button_terp'} %>
    <% else %>
      <%= link_to "Got It! Next Question >", 
                  terp_solicit_free_response_path(
                      terp_id: params[:terp_id], 
                      student_exercise_id: next_se.id),
                  {class: 'link_button_terp'} %>
    <% end %>
  </div>

</div>

<%= render :partial => 'shared/response_times',
           :locals => {:response_timeable => @student_exercise,
                       :page => "feedback"} %>

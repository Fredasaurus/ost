
<style type='text/css'>
  .analytics-topic {
    padding-bottom: 10px;
  }
  .analytics-topic-name {
    font-style: italic;
  }
  .analytics-topic-details {
    padding-left: 30px;
  }
</style>

<%
  student = @klass.student_for(present_user) 
  student_exercises = StudentExercise.joins{student_assignment.student}
                                     .joins{assignment_exercise.topic_exercise.topic}
                                     .where{student_assignment.student.id == student.id}

  student_exercises_by_topic =
      student_exercises.group_by{|se| se.assignment_exercise.topic_exercise.topic}
%>

<% student_exercises_by_topic.each do |topic, student_exercises| %>

  <% num_exercises = student_exercises.count
     student_exercises = student_exercises.select{|se| se.automated_credit != nil}
     num_incomplete = num_exercises - student_exercises.count
     num_wrong = student_exercises.count{|se| se.automated_credit == 0}
     right_sum = student_exercises.sum{|se| se.automated_credit} %>

  <div class="analytics-topic">
    <div class="analytics-topic-name">
      <%= topic.name %>
    </div>
    <div class="analytics-topic-details">
      <div class="analytics-topic-data" id="topic_<%= topic.id %>">
        <%= "(#{right_sum}, #{num_wrong}, #{num_incomplete})/(#{num_exercises})" %> 

        <script type="text/javascript">
          $(function () {
              var values = [<%= right_sum %>, <%= num_wrong %>, <%= num_incomplete %>],
                  labels = ['Correct', 'Wrong', 'Incomplete'],
                  colors = [Raphael.rgb(118, 177, 67), '#F47641', '#5F6163'],
                  options = {
                    stroke: {
                      width: 1,
                      color: '#233066'
                    }
                  };
              Raphael("topic_<%= topic.id%>", 200, 200).pieChart(100, 100, 30, values, labels, colors, options);
          });
        </script>


      </div>
      <div class="analytics-topic-study">
      </div>
      <div class="analytics-topic-review">
      </div>
    </div>
  </div>
<% end %>